{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"1. Mobile Access Gateway","text":"<p>The Mobile Access Gateway (MAG) is an implementation based on the CH EPR FHIR Implementation Guide (IG). It provides a FHIR gateway that supports the mobile IHE server actors and translates them into IHE XDS/HL7v3 transactions.</p> <p>It uses IPF and HAPI-FHIR.</p> <p>You can find more details about its features, available endpoints, Docker container setup, and change history in the documentation. A more complete description of the transactions required for the EPR integration of primary systems is also provided.</p> <p>For further information, see the website or the GitHub repository.</p>"},{"location":"changelog/","title":"7. Changelog","text":""},{"location":"changelog/#v204-unreleased","title":"v2.0.4 - Unreleased","text":"<ul> <li>Fix the ATNA TLS initialization (#37).</li> </ul>"},{"location":"changelog/#v203-20251008","title":"v2.0.3 - 2025/10/08","text":"<ul> <li>Add STS/TCU support for emedo (#24).</li> <li>Update Postman collection for emedo.</li> <li>Remove the configuration parameter <code>mag.auth.sts-issuer</code> (#27).</li> <li>Remove the configuration parameter <code>mag.auth.tcu.template-path</code> (#26).</li> <li>Add the configuration parameter <code>mag.auth.tcu.oid</code> (#26).</li> <li>Add author support in publication (#31).</li> <li>Implement the automatic loop on confidentiality codes when publishing a document (#22).</li> </ul>"},{"location":"changelog/#v202-20251001","title":"v2.0.2 - 2025/10/01","text":"<ul> <li>Enable https with client certificates and without (#19).</li> <li>Fix startup issue when XCA endpoints are not defined (#18). </li> </ul>"},{"location":"changelog/#v201-20250930","title":"v2.0.1 - 2025/09/30","text":"<ul> <li>Simplify the patient identifier feed (#15).   The <code>Patient.managingOrganization</code> isn't needed anymore.</li> <li>Create the configuration parameter <code>mag.organization-name</code>.</li> <li>Fix the URN-encoding of <code>DocumentEntry.entryUUID</code> (#16).</li> <li>Don't return an OperationOutcome in ITI-119 when there are no matches (#17).</li> </ul>"},{"location":"changelog/#v200-20250926","title":"v2.0.0 - 2025/09/26","text":"<ul> <li>Initial release of this MobileAccessGateway instance for integration to the Swiss EPR.</li> <li>The application is running on Java 25, Jetty 12.0.25, IPF 5.1.0, Spring Boot 3.5.5, FHIR Core 6.5.18 and HAPI FHIR   8.2.1.</li> <li>This version has been tested at the Digital Health Projectathon 2025 in Bern.</li> </ul>"},{"location":"configuration/","title":"8. Configuration","text":"<p>This page details how to configure the MobileAccessGateway application.</p>"},{"location":"configuration/#publish-as-tcu-without-xua-token","title":"Publish as TCU without XUA token","text":"<p>The MAG can automatically inject a technical user (TCU) XUA token into ITI-65 requests when no <code>Authorization</code>  header is present. To do that, the following configuration parameters must be set:</p> <pre><code>mag:\n    auth:\n        sts: http://${host}/STS/services/SecurityTokenService\n        sts-issuer: https://test.ahdis.ch/mag-cara\n        tcu:\n            principal-name: Gregory House\n            principal-gln: 2000040030826\n            oid: 2.16.756.5.30.1.999.9.1.1.1\n            keystore-path: file:secret/tcu.p12\n            keystore-password: MySecretPassword\n            keystore-alias: mykeyalias\n            auto-inject-in-iti65: true\n</code></pre> <p>Details of the parameters:</p> <ul> <li><code>mag.auth.sts</code>: The URL of the STS service (for the Get X-User Assertion request).</li> <li><code>mag.auth.sts-issuer</code>: The <code>Assertion/Issuer</code> value of the TCU SAML Assertion.</li> <li><code>mag.auth.tcu.principal-name</code>: The <code>Subject/NameID</code> value of the TCU SAML Assertion.</li> <li><code>mag.auth.tcu.principal-gln</code>: The <code>Subject/SubjectConfirmation/Data/Recipient</code> value of the TCU SAML Assertion.</li> <li><code>mag.auth.tcu.oid</code>: The OID of the TCU, as registered in the EPR community.</li> <li><code>mag.auth.tcu.keystore-path</code>: The path to the keystore containing the private key to sign the SAML Assertion. It    should begin with <code>file:</code> and be a PKCS#12 file (<code>.p12</code> or <code>.pfx</code>).</li> <li><code>mag.auth.tcu.keystore-password</code>: The password of the keystore.</li> <li><code>mag.auth.tcu.keystore-alias</code>: The alias of the private key in the keystore.</li> <li><code>mag.auth.tcu.auto-inject-in-iti65</code>: Set to <code>true</code> to enable the automatic injection of the TCU token in ITI-65    requests.</li> </ul>"},{"location":"configuration/#create-a-pkcs12-keystore","title":"Create a PKCS#12 keystore","text":"<p>You need a PKCS#12 keystore for using mTLS with the EPR service, and for signing the TCU SAML Assertion (if you  enabled that option). To create a PKCS#12 keystore, you need a private key and a certificate that you may have generated yourself, or that  you received from a certificate authority/EPR community. They will usually be in the PEM format (files usually ending with <code>.pem</code>, <code>.crt</code>, <code>.cer</code> or <code>.key</code>); the certificate  should start with <code>-----BEGIN CERTIFICATE-----</code> and the private key with <code>-----BEGIN PRIVATE KEY-----</code>, <code>BEGIN ENCRYPTED PRIVATE KEY</code> or <code>BEGIN RSA PRIVATE KEY</code>.</p> <p>In a terminal with OpenSSL: 1. To create a new keystore:    <code>openssl pkcs12 -export -in cert.pem -inkey private_pkcs8.pem -out keystore.p12 -name mykeyalias</code>. OpenSSL will take    care of any type of private key (PKCS#1, PKCS#8, encrypted or not). 2. Optional: fill the private key password (Enter pass phrase for private.pem). 3. Fill the keystore password (Enter Export Password).</p> <p>To add one key pair from one PKCS#12 keystore to another PKCS#12 keystore: 1. <code>keytool -importkeystore -deststorepass:file destKeyStorePasswordFile -destkeystore destination.p12 -srckeystore source.p12 -deststoretype PKCS12 -srcstoretype PKCS12 -srcstorepass:file myOutPasswordFile -alias mykeyalias</code></p> <p>In a GUI with KeyStore Explorer: 1. Open KeyStore Explorer, click on <code>Create a new KeyStore</code> and choose <code>PKCS#12</code>, or open an existing PKCS#12 keystore. 2. Right-click in the empty area and choose <code>Import Key Pair</code>. 3. Select <code>Import from PEM encoded files</code>. 4. If your private key had <code>RSA PRIVATE KEY</code>, select <code>OpenSSL</code>. Otherwise (<code>PRIVATE KEY</code> and <code>ENCRYPTED PRIVATE KEY</code>),    select <code>PKCS#8</code>. 5. Select your private key file and your certificate file; specify the password of the private key if needed. 6. Enter an alias for the key pair. You will fill it in the configuration properties <code>mag.auth.tcu.keystore-alias</code> or     <code>mag.client-ssl.cert-alias</code>. 7. Leave the key pair password fields empty. 8. Save your keystore.</p> <p>It should look like: </p>"},{"location":"configuration/#create-a-pkcs12-truststore","title":"Create a PKCS#12 truststore","text":"<p>You need a PKCS#12 truststore for using mTLS with the EPR service. To create a PKCS#12 truststore, you need the  certificate(s) to trust. \u2013 it can be the leaf certificate, any intermediate certificate(s) and/or the CA certificate. The choice of the certificate to trust is yours:</p> <ol> <li>The leaf certificate is the safer to trust, because only the owner of the private key of that certificate will be     trusted. But when the leaf certificate is renewed (usually every year), you will need to update your truststore.     The MAG won't work anymore until you do that, so it is not very convenient.</li> <li>The intermediate certificate(s) or the CA certificate are more convenient, because they usually have a longer validity     (many years). But they are less safe, because any leaf certificate issued by that CA will be trusted \u2013 although     CAs trusted by your browser should be very strict when issuing a certificate for a given domain.</li> </ol> <p>When finding the certificate(s) to trust, both OpenSSL and your browser will show you the validity period of each  certificate in the chain.</p> <p>To find the certificates of a TLS host:</p> <p>In a terminal with OpenSSL: <code>openssl s_client -connect www.epr.ch:443 -showcerts</code>. You will find the leaf, intermediate and root certificates in the output, each starting with  <code>-----BEGIN CERTIFICATE-----</code> and ending with <code>-----END CERTIFICATE-----</code>. Copy the certificate you want, including  the boundaries (<code>-----BEGIN CERTIFICATE-----</code> and <code>-----END CERTIFICATE-----</code>), into a <code>.pem</code> file.</p> <p>In a GUI with Chrome: 1. Click on the View site information icon on the left of the address bar:     2. Click on Connection is secure. 3. Click on Certificate is valid. 4. In the Details tab, select the certificate you want to trust. At the top is the CA, at the bottom is the    leaf certificate. 5. Click on the Export button (bottom right) and save the certificate in the <code>.pem</code> format.</p> <p>Then, add it to a PKCS#12 truststore \u2013 it can be the same file as the keystore.</p> <p>In a terminal with OpenSSL to create a new keystore: <code>openssl pkcs12 -export -in trusted_cert.pem -nokeys -out truststore.p12 -name trustalias</code></p> <p>In a terminal with keytool to add one certificate to an existing keystore: <code>keytool -import -trustcacerts -keystore existing.p12 -storetype PKCS12 -storepass yourKeystorePassword -alias trustalias -file trusted_cert.pem</code></p> <p>In a GUI with KeyStore Explorer: 1. Open KeyStore Explorer, click on <code>Create a new KeyStore</code> and choose <code>PKCS#12</code>, or open an existing PKCS#12 keystore. 2. Right-click in the empty area and choose <code>Import Trusted Certificate</code>. 3. Select the certificate file you created above. 4. Enter an alias for the certificate. This alias won't be used in the configuration, so choose an alias that helps you     remember what certificate it is. 5. Save your truststore.</p> <p>It should look like: </p>"},{"location":"docker/","title":"6. Mobile Access Container","text":""},{"location":"docker/#61-download","title":"6.1 Download","text":"<p>You can download the Mobile Access Gateway as a docker container:</p> <pre><code>docker pull europe-west6-docker.pkg.dev/ahdis-ch/ahdis/mag-cara:version\n</code></pre>"},{"location":"docker/#62-configurable-base-image","title":"6.2 Configurable Base Image","text":"<p>Run from the cloned Mobile Access Gateway:</p> <pre><code>docker run -d -it --name mag -p 9090:9090 -v /Users/oegger/Documents/github/MobileAccessGateway/example-playground:/config/ europe-west6-docker.pkg.dev/ahdis-ch/ahdis/mag:v062\ndocker logs --follow mag\n</code></pre> <p>Server endpoint will then be accessible at http://localhost:9090/mag/fhir/metadata.</p> <p>You can check for example a PIXm query against the EPD playground:</p> <pre><code>http://localhost:9090/mag/fhir/Patient/$ihe-pix?sourceIdentifier=urn%3Aoid%3A2.16.756.5.30.1.127.3.10.3%7C761337615395845832&amp;targetSystem=urn%3Aoid%3A1.1.1.99.1&amp;targetSystem=urn%3Aoid%3A2.16.756.5.30.1.127.3.10.3\n</code></pre> <p>The Mobile Access Gateway supports also a GUI which is accessible at http://localhost:9090/mag/#/.</p>"},{"location":"docker/#63-live-and-readiness-checks","title":"6.3 Live and Readiness Checks","text":"<p>To check if the container is live and ready you can check the health:</p> <pre><code>GET http://localhost:9090/mag/actuator/health HTTP/1.1\nAccept: application/vnd.spring-boot.actuator.v3+json\n\nHTTP/1.1 200\nContent-Type: application/vnd.spring-boot.actuator.v3+json\nTransfer-Encoding: chunked\nDate: Thu, 02 Feb 2023 15:55:12 GMT\nVia: 1.1 google\nAlt-Svc: h3=\":443\"; ma=2592000,h3-29=\":443\"; ma=2592000\nConnection: close\n\n{\n  \"status\": \"UP\"\n}\n</code></pre>"},{"location":"endpoints/","title":"3. Endpoints","text":"<p>This are the endpoints exposed by the Mobile Access Gateway.</p> Transaction URL ITI-65 instance/fhir/ ITI-67 instance/fhir/DocumentReference ITI-83 instance/fhir/Patient/$ihe-pix ITI-104 instance/fhir/Patient ITI-119 instance/fhir/Patient/$match CH:MHD-1 instance/fhir/DocumentReference CH:PPQ-3 instance/fhir CH:PPQ-4 instance/fhir CH:PPQ-5 instance/fhir"},{"location":"features/","title":"2. Features","text":""},{"location":"features/#21-ihe-transactions-actors","title":"2.1 IHE Transactions &amp; Actors","text":"<p>The Mobile Access Gateway (MAG) provides translation between REST/FHIR requests defined in the CH EPR FHIR IG and SOAP/HL7v3 variants of IHE transactions.    </p> <p>The table below lists the supported IHE profiles, their transactions and the involved IHE actors implemented in the MAG. </p> REST/FHIR SOAP/HL7v3 Profile Transaction Actor -&gt; Actor Transaction Profile PDQm Patient Demographics Match [ITI-119] Patient Demographics Supplier -&gt; Patient Demographics Consumer Patient Demographics Query HL7 V3 [ITI-47] PDQV3 PIXm Mobile Patient Identifier Cross-reference Query [ITI-83] Patient Identity Manager -&gt; Patient Identifier Cross-reference Consumer PIXV3 Query [ITI-45] PIXV3 PIXm Patient Identity Feed FHIR [ITI-104] Patient Identity Manager -&gt; Patient Identity Source Patient Identity Feed HL7 V3 [ITI-44] PIXV3 MHD Provide Document Bundle [ITI-65] Document Recipient -&gt; Document Source, X-Service-User Provide and Register Document Set-b [ITI-41] XDS.b MHD Update Document Metadata [CH:MHD-1] Document Responder -&gt; Document Administrator Update Document Set [ITI-57] XDS.b MHD Find Document References [ITI-67] Document Responder -&gt; Document Consumer, X-Service-User Registry Stored Query [ITI-18] XDS.b MHD Retrieve Document [ITI-68] Document Responder -&gt; Document Consumer, X-Service-User Retrieve Document Set [ITI-43] XDS.b CH:PPQm Mobile Privacy Policy Feed [CH:PPQ-3] Policy Repository -&gt; Policy Source Privacy Policy Feed [CH:PPQ\u20111] / Privacy Policy Retrieve [CH:PPQ\u20112] CH:PPQ CH:PPQm Mobile Privacy Policy Bundle Feed [CH:PPQ-4] Policy Repository -&gt; Policy Source Privacy Policy Feed [CH:PPQ\u20111] / Privacy Policy Retrieve [CH:PPQ\u20112] CH:PPQ CH:PPQm Mobile Privacy Policy Retrieve [CH:PPQ-5] Policy Repository -&gt; Policy Source Privacy Policy Retrieve [CH:PPQ\u20112] CH:PPQ"},{"location":"features/#211-authenticationauthorization","title":"2.1.1 Authentication/Authorization","text":"<ol> <li>PDQm and PIXm transactions don't require authentication.</li> <li>ITI-65 requests can be automatically authorized as the configured Technical User (TCU).</li> <li>Other MHD transactions require authorization.</li> </ol>"},{"location":"features/#22-ch-epr-constraints","title":"2.2 CH EPR Constraints","text":"<p>The Swiss EPR defines constraints on the use of MHD, PIXm, PDQm and PPQm transactions. Those can be enabled in the  configuration file: <pre><code>mag:\n  ch-epr-fhir:\n    ch-mhd-constraints: true\n    ch-ppqm-constraints: true\n    ch-pixm-constraints: true\n    ch-pdqm-constraints: true\n</code></pre></p> <p>Furthermore, the parameter <code>mag.ch-epr-fhir.epr-spid-as-patientid</code> allows to set the patient EPR-SPID as the FHIR  Patient id. The mapping will automatically be changed to support that.</p>"},{"location":"features/#23-auto-looping-on-chepr-confidentiality-codes","title":"2.3 Auto looping on CH:EPR confidentiality codes","text":"<p>When publishing a document via ITI-65, the MAG will automatically loop on the confidentiality codes defined in the  Swiss EPR if the request fails, and the failure code/reason may indicate that the confidentiality code is not  supported.</p> <p>The MAG will start at the confidentiality code defined in the request, and go up to <code>SECRET</code>.</p>"},{"location":"integration-primary-system/","title":"4. EPR Primary System Integration","text":""},{"location":"integration-primary-system/#41-introduction","title":"4.1 Introduction","text":"<p>The REST variants of XDS transactions presented here are based on CH EPR FHIR, itself based on various IHE profiles.</p> <p> Don't forget to properly encode the HTTP parameters in the queries (especially colons and pipes). For readability, parameters are shown decoded, and the <code>Authorization</code> and <code>Accept</code> headers are omitted from the examples.</p> <p> For HTTP GET requests, there is usually an equivalent HTTP POST request that should be supported.</p>"},{"location":"integration-primary-system/#42-authentication","title":"4.2 Authentication","text":"<p>The sequence diagram shows the currently implemented authentication flow.</p> <p>You should integrate one of the supported IDPs in your application. The OAuth/IUA flow is supported for clients, the SAML flow is the only one implemented between the  Mobile Access Gateway and the IDP.</p> <p>Once you get the IDP SAML assertion, you can trade it for the community SAML assertion, which binds your IDP identification to a specific patient and a purpose of use. It is an HTTP POST request to <code>/assertion</code>, with the header <code>Scope</code> and the IDP SAML assertion as body. The header <code>Scope</code> contains the following values:</p> <ul> <li><code>purpose_of_use</code> (token, required):   a value from EprPurposeOfUse</li> <li><code>subject_role</code> (token, required):   either <code>HCP</code>, <code>ASS</code>, <code>PAT</code> or <code>REP</code> in the system <code>urn:oid:2.16.756.5.30.1.127.3.10.6</code></li> <li><code>person_id</code> (string, required):   the patient EPR-SPID in the CX format</li> <li><code>principal</code> (string, only if role is <code>ASS</code>):    the name of the healthcare professional on whose behalf an assistant is acting</li> <li><code>principal_id</code> (token, only if role is <code>ASS</code>):    the GLN of the healthcare professional on whose behalf an assistant is acting</li> <li><code>group</code> (string, only if role is <code>ASS</code>):    the name of the organization or group on whose behalf an assistant is acting</li> <li><code>group_id</code> (token, only if role is <code>ASS</code>):    the OID of the organization or group on whose behalf an assistant is acting</li> </ul> Request<pre><code>POST /assertion HTTP/1.1\nScope: person_id=761337610445502987^^^&amp;2.16.756.5.30.1.127.3.10.3&amp;ISO purpose_of_use=urn:oid:2.16.756.5.30.1.127.3.10.5|NORM subject_role=urn:oid:2.16.756.5.30.1.127.3.10.6|HCP\nContent-Type: application/xml\n\n&lt;saml2:Assertion xmlns:saml2=\"urn:oasis:names:tc:SAML:2.0:assertion\" Version=\"2.0\"&gt;\n  &lt;!-- Content of the IDP assertion\u2026 --&gt;\n&lt;/saml2:Assertion&gt;\n</code></pre> <p>The response then looks like:</p> Response<pre><code>HTTP/1.1 200 OK\nContent-Type: application/json\n\n{\n  \"access_token\": \"U0FNTGFzc2VydGlvbg\",\n  \"token_type\": \"IHE-SAML\",\n  \"expires_in\": 60000,\n  \"scope\": \"resourceId/761337610445502987 purposeOfUse/NORM role/HCP\"\n}\n</code></pre> <p>The base64-url encoded SAML assertion is given in <code>access_token</code>, and that value has to be prefixed with <code>Bearer\u00a0</code> and inserted in an <code>Authorization</code> HTTP header for all transactions that require it.</p> Example of request with the XUA<pre><code>GET /... HTTP/1.1\nAuthorization: Bearer U0FNTGFzc2VydGlvbg\n</code></pre>"},{"location":"integration-primary-system/#43-patient-directory","title":"4.3 Patient Directory","text":"<p>The patient directory, called the Master Patient Index (MPI), contains identifiers and demographics for all registered patients. Identifiers include the MPI-PID and EPR-SPID, and identifiers used by primary systems that choose to share them. Demographics include the given and family names, date of birth, gender, nationality, telecoms and address information. It can be queried and updated.</p>"},{"location":"integration-primary-system/#431-retrieving-patient-identifiers-iti-83","title":"4.3.1 Retrieving Patient Identifiers [ITI-83]","text":"<p>Patient identifiers (commonly the MPI-PID and EPR-SPID) can be queried with an ITI-83 (Mobile Patient Identifier Cross-reference Query) transaction.</p> <p>The transaction is an HTTP GET request to the endpoint <code>/Patient/$ihe-pix</code>, with the following parameters:</p> <ol> <li><code>sourceIdentifier</code> (token, required):   the known patient identifier</li> <li><code>targetSystem</code> (uri, 1..2):   to restrict the results to the EPR-SPID (required) and MPI-PID (optional)</li> </ol> Examples Retrieve the patient's EPR-SPID using a local system identifier (1234 in the system 2.999.42)<pre><code>GET /Patient/$ihe-pix?sourceIdentifier=urn:oid:2.999.42|1234&amp;targetSystem=urn:oid:2.16.756.5.30.1.127.3.10.3 HTTP/1.1\n</code></pre> Retrieve the patient's EPR-SPID using the social security number (AHVN13/NAVS13)<pre><code>GET /Patient/$ihe-pix?sourceIdentifier=urn:oid:2.16.756.5.32|{ahvn13}&amp;targetSystem=urn:oid:2.16.756.5.30.1.127.3.10.3 HTTP/1.1\n</code></pre> Retrieve the patient's EPR-SPID using the MPI-PID<pre><code>GET /Patient/$ihe-pix?sourceIdentifier=urn:oid:2.16.756.5.30.1.191.1.0.12.3.101|{mpi-pid}&amp;targetSystem=urn:oid:2.16.756.5.30.1.127.3.10.3 HTTP/1.1\n</code></pre> Retrieve the patient's MPI-PID using the EPR-SPID<pre><code>GET /Patient/$ihe-pix?sourceIdentifier=urn:oid:2.16.756.5.30.1.127.3.10.3|{epr-spid}&amp;targetSystem=urn:oid:2.16.756.5.30.1.127.3.10.3&amp;targetSystem=urn:oid:2.16.756.5.30.1.191.1.0.12.3.101 HTTP/1.1\n</code></pre>"},{"location":"integration-primary-system/#432-patient-matching-iti-119","title":"4.3.2 Patient Matching [ITI-119]","text":"<p>The patient's participation in the Swiss EPD can be queried with an ITI-119 (Patient Demographics Match) transaction.    The patient data shall conform to this profile: <code>http://fhir.ch/ig/ch-epr-fhir/StructureDefinition/ch-pdqm-patient</code>.</p> <p>The transaction is an HTTP POST request to the endpoint <code>/Patient/$match</code>.</p> <p>There are two ways to perform the match:</p> <ol> <li>Using a <code>Parameters</code> resource that contains the patient as an input parameter </li> <li>Posting the <code>Patient</code> resource directly as the body of the request</li> </ol> 1. <code>Parameters</code>2. <code>Patient</code> <p>Example Query with identifier (EPR-SPID)<pre><code>POST /Patient/$match HTTP/1.1\nContent-Type: application/fhir+json\n\n{\n  \"resourceType\" : \"Parameters\",\n  \"parameter\" : [\n    {\n      \"name\" : \"resource\",\n      \"resource\" : {\n        \"resourceType\" : \"Patient\",\n        \"identifier\" : [\n            {\n            \"system\" : \"urn:oid:2.16.756.5.30.1.127.3.10.3\",\n            \"value\" : \"761337611735842172\"\n            }\n        ]\n      }\n    }\n  ]\n}\n</code></pre> <p>Example Query with family name and birthdate<pre><code>POST /Patient/$match HTTP/1.1\nContent-Type: application/fhir+json\n\n{\n  \"resourceType\" : \"Patient\",\n  \"identifier\" : [\n    {\n      \"system\" : \"urn:oid:2.16.756.5.30.1.127.3.10.3\",\n      \"value\" : \"761337611735842172\"\n    }\n  ],\n  \"name\" : [\n    {\n      \"family\" : \"NEFF-WINGEIER\",\n      \"given\" : [\n        \"Trong Sang\"\n      ]\n    }\n  ],\n  \"gender\" : \"male\",\n  \"birthDate\" : \"1987-10-08\"\n}\n</code></pre>"},{"location":"integration-primary-system/#433-retrieving-patient-demographics","title":"4.3.3 Retrieving Patient Demographics","text":""},{"location":"integration-primary-system/#4331-patient-read","title":"4.3.3.1 Patient Read","text":"<p>A single patient can be retrieved by performing the transaction with the EPR-SPID specified.  The transaction is an HTTP GET request to the endpoint <code>/Patient/{id}</code>, where <code>{id}</code> is the identifier value.</p> Retrieve by EPR-SPID<pre><code>GET /Patient/761337615866818761 HTTP/1.1\n</code></pre>"},{"location":"integration-primary-system/#4332-patient-search-iti-78","title":"4.3.3.2 Patient Search [ITI-78]","text":"<p>Patient demographics can also be queried with an ITI-78 (Mobile Patient Demographics Query) transaction (not part of the CH EPR FHIR specification).</p> <p>The transaction to retrieve a single patient can be done by specifying patient's information.  These search parameters can be used to search the patient:</p> <ul> <li><code>family</code> and <code>given</code> (string)</li> <li><code>identifier</code> (token)</li> <li><code>telecom</code> (token)</li> <li><code>birthdate</code> (date)</li> <li><code>address</code> (string): to search in any part of the address</li> <li><code>address-city</code>,   <code>address-country</code>,   <code>address-postalcode</code>,   <code>address-state</code> (string)</li> <li><code>gender</code> (token)</li> </ul> Example with combined search parameters<pre><code>GET /Patient?family=MOHR&amp;given=ALICE&amp;gender=female HTTP/1.1\n</code></pre>"},{"location":"integration-primary-system/#434-feeding-patient-information","title":"4.3.4 Feeding Patient Information","text":""},{"location":"integration-primary-system/#4341-feed-by-local-pid-with-epr-spid-iti-104","title":"4.3.4.1 Feed by Local PID (with EPR-SPID) [ITI-104]","text":"<p>Feeding patient information can be done with the ITI-104 (Patient Identity Feed FHIR) transaction.  The following profile shall be used: <code>http://fhir.ch/ig/ch-epr-fhir/StructureDefinition/ch-pixm-patient-feed</code>.</p> <p>The EPR-SPID is required as <code>identifier</code> element according the profile. You don't have to re-specify the other identifiers, they won't be deleted if they're missing from the request. If you want to add an identifier, you can put it in another <code>identifier</code> element.</p> Example Add local PID by local PID<pre><code>PUT /Patient?identifier=urn:oid:2.999.1.2.3.4|8734 HTTP/1.1\nContent-Type: application/fhir+json\n\n{\n    \"resourceType\": \"Patient\",\n    \"id\": \"2.999.1.2.3.4-8734\",\n    \"identifier\" : [\n        {\n            \"type\" : {\n                \"coding\" : [\n                    {\n                        \"system\" : \"http://terminology.hl7.org/CodeSystem/v2-0203\",\n                        \"code\" : \"MR\"\n                    }\n                ]\n            },\n            \"system\" : \"urn:oid:2.999.1.2.3.4\",\n            \"value\" : \"8734\"\n        },\n        {\n            \"system\" : \"urn:oid:2.16.756.5.30.1.127.3.10.3\",\n            \"value\" : \"EPR-SPID\"\n        }\n    ],\n    \"active\": true,\n    \"name\": [\n        {\n            \"family\": \"NEFF-WINGEIER\",\n            \"given\": [\n                \"Trong Sang\"\n            ]\n        }\n    ],\n    \"gender\": \"male\",\n    \"birthDate\": \"1987-10-08\"\n}\n</code></pre>"},{"location":"integration-primary-system/#4342-feed-by-local-pid-without-epr-spid","title":"4.3.4.2 Feed by Local PID (without EPR-SPID)","text":"<p>Performing the patient information feed transaction without specifying the EPR-SPID is possible, but it is not conformant with the CH EPR FHIR specification.</p> Example Add AHVN13 by local PID<pre><code>PUT /Patient?identifier=urn:oid:2.999.1.2.3.4|8734 HTTP/1.1\nContent-Type: application/fhir+json\n\n{\n    \"resourceType\": \"Patient\",\n    \"id\": \"2.999.1.2.3.4-8734\",\n    \"identifier\" : [\n        {\n            \"type\" : {\n                \"coding\" : [\n                    {\n                        \"system\" : \"http://terminology.hl7.org/CodeSystem/v2-0203\",\n                        \"code\" : \"MR\"\n                    }\n                ]\n            },\n            \"system\" : \"urn:oid:2.999.1.2.3.4\",\n            \"value\" : \"8734\"\n        },\n        {\n            \"system\" : \"urn:oid:2.16.756.5.32\",\n            \"value\" : \"AHVN13\"\n        }\n    ],\n    \"active\": true,\n    \"name\": [\n        {\n            \"family\": \"NEFF-WINGEIER\",\n            \"given\": [\n                \"Trong Sang\"\n            ]\n        }\n    ],\n    \"gender\": \"male\",\n    \"birthDate\": \"1987-10-08\"\n}\n</code></pre>"},{"location":"integration-primary-system/#44-document-directory","title":"4.4 Document Directory","text":"<p>The document directory stores documents (in the document repository) and their metadata (in the document registry).</p>"},{"location":"integration-primary-system/#441-searching-iti-67iti-66","title":"4.4.1 Searching [ITI-67]/[ITI-66]","text":"<p>You can search the document registry with the ITI-67 (Find Document References) transaction.</p> <p>The transaction is an HTTP GET request to the endpoint <code>/DocumentReference</code>, the search parameters are described in the MHD ITI-67 specifications.</p> Examples Search all documents from a patient<pre><code>GET /DocumentReference?patient.identifier=urn:oid:2.999|11111111&amp;status=current HTTP/1.1\n</code></pre> Search by class and type codes<pre><code>GET /DocumentReference?patient.identifier=urn:oid:2.999|11111111&amp;category=http://snomed.info/sct|371531000&amp;type=http://snomed.info/sct|419891008 HTTP/1.1\n</code></pre> Search by creation date<pre><code>GET /DocumentReference?patient.identifier=urn:oid:2.999|11111111&amp;creation=ge2023-07-10&amp;creation=le2023-07-17 HTTP/1.1\n</code></pre> <p>You can also search for SubmissionSets with the ITI-66 (Find Document Lists) transaction (not part of the CH EPR FHIR specification).</p> Examples Search all by patient identifier<pre><code>GET /List?patient.identifier=urn:oid:2.999|11111111 HTTP/1.1\n</code></pre> Search with additional parameters<pre><code>GET /List?patient.identifier=urn:oid:2.999|11111111&amp;code=submissionset&amp;status=current&amp;designationType=http://loinc.org|1234-5 HTTP/1.1\n</code></pre>"},{"location":"integration-primary-system/#442-reading-iti-68","title":"4.4.2 Reading [ITI-68]","text":"<p>Retrieving a document is done with the ITI-68 (Retrieve Document) transaction. It is a simple HTTP GET request to an URL that you will find in the linked DocumentReference (that you can obtain with search results): <code>DocumentReference.content.attachment.url</code>.</p>"},{"location":"integration-primary-system/#443-publishing-iti-65","title":"4.4.3 Publishing [ITI-65]","text":"<p>You can publish a document with the ITI-65 (Provide Document Bundle) transaction.</p> <p>The transaction is an HTTP POST request to the endpoint <code>/</code>.   The <code>Bundle.meta.profile</code> element shall have the following value: <code>https://profiles.ihe.net/ITI/MHD/StructureDefinition/IHE.MHD.Comprehensive.ProvideBundle</code>.</p> Example Publish a PDF file<pre><code>POST / HTTP/1.1\nContent-Type: application/fhir+json\n\n{\n  \"entry\": [\n    {\n      \"fullUrl\": \"urn:uuid:59f3a738-11c1-4a0e-a89b-c4552d0fe9a7\",\n      \"request\": {\n        \"method\": \"POST\",\n        \"url\": \"Binary\"\n      },\n      \"resource\": {\n        \"contentType\": \"application/pdf\",\n        \"data\": \"VGhlIHBkZiBmaWxlIGdvZXMgaGVyZQ==\",\n        \"resourceType\": \"Binary\"\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uid:eb00c215-61cf-43a3-b99a-020ab21828fa\",\n      \"request\": {\n        \"method\": \"POST\",\n        \"url\": \"List\"\n      },\n      \"resource\": {\n        \"code\": {\n          \"coding\": [\n            {\n              \"code\": \"submissionset\",\n              \"display\": \"SubmissionSet as a FHIR List\",\n              \"system\": \"http://profiles.ihe.net/ITI/MHD/CodeSystem/MHDlistTypes\"\n            }\n          ]\n        },\n        \"date\": \"2023-01-06T14:23:14+01:00\",\n        \"entry\": [\n          {\n            \"item\": {\n              \"reference\": \"urn:uuid:5ae558f6-c103-4566-9a7e-63242abd24ab\"\n            }\n          }\n        ],\n        \"extension\": [\n          {\n            \"url\": \"http://profiles.ihe.net/ITI/MHD/StructureDefinition/ihe-sourceId\",\n            \"valueIdentifier\": {\n              \"value\": \"urn:oid:2.16.756.5.30.1.145.20.1\"\n            }\n          },\n          {\n            \"url\": \"http://fhir.ch/ig/ch-epr-fhir/StructureDefinition/ch-ext-author-authorrole\",\n            \"valueCoding\": {\n              \"code\": \"HCP\",\n              \"display\": \"Healthcare professional\",\n              \"system\": \"urn:oid:2.16.756.5.30.1.127.3.10.6\"\n            }\n          },\n          {\n            \"url\": \"http://profiles.ihe.net/ITI/MHD/StructureDefinition/ihe-designationType\",\n            \"valueCodeableConcept\": {\n              \"coding\": [\n                {\n                  \"code\": \"71388002\",\n                  \"display\": \"Procedure (procedure)\",\n                  \"system\": \"http://snomed.info/sct\"\n                }\n              ],\n              \"text\": \"Procedure (procedure)\"\n            }\n          }\n        ],\n        \"identifier\": [\n          {\n            \"system\": \"urn:ietf:rfc:3986\",\n            \"use\": \"official\",\n            \"value\": \"urn:uuid:ab1862da-e31e-4ca9-ab01-24883cda5404\"\n          },\n          {\n            \"system\": \"urn:ietf:rfc:3986\",\n            \"use\": \"usual\",\n            \"value\": \"urn:oid:2.999.123\"\n          }\n        ],\n        \"mode\": \"working\",\n        \"resourceType\": \"List\",\n        \"status\": \"current\",\n        \"subject\": {\n          \"reference\": \"Patient/2.16.756.5.30.1.191.1.0.2.1-c55f4ca7-bd4e-4134-8dcd-56b793ade958\"\n        }\n      }\n    },\n    {\n      \"fullUrl\": \"urn:uuid:5ae558f6-c103-4566-9a7e-63242abd24ab\",\n      \"request\": {\n        \"method\": \"POST\",\n        \"url\": \"DocumentReference\"\n      },\n      \"resource\": {\n        \"author\": [\n          {\n            \"reference\": \"#practrole\"\n          }\n        ],\n        \"category\": [\n          {\n            \"coding\": [\n              {\n                \"code\": \"405624007\",\n                \"display\": \"Administrative documentation (record artifact)\",\n                \"system\": \"http://snomed.info/sct\"\n              }\n            ]\n          }\n        ],\n        \"contained\": [\n          {\n            \"birthDate\": \"1993-01-27\",\n            \"gender\": \"male\",\n            \"id\": \"1\",\n            \"identifier\": [\n              {\n                \"system\": \"urn:oid:2.16.756.5.30.1.191.1.0.12.3.101\",\n                \"value\": \"MAGMED006\"\n              },\n              {\n                \"system\": \"urn:oid:2.16.756.5.30.1.191.1.0.2.1\",\n                \"value\": \"c55f4ca7-bd4e-4134-8dcd-56b793ade958\"\n              }\n            ],\n            \"name\": [\n              {\n                \"family\": \"Seszt\u00e1kov\u00e1\",\n                \"given\": [\n                  \"Jett Flynn\"\n                ]\n              },\n              {\n                \"family\": \"Seszt\u00e1kov\u00e1\",\n                \"given\": [\n                  \"Jett Flynn\"\n                ]\n              }\n            ],\n            \"resourceType\": \"Patient\"\n          },\n          {\n            \"address\": [\n              {\n                \"city\": \"Z\u00fcrich\",\n                \"country\": \"CH\",\n                \"line\": [\n                  \"Krankenstrasse 2\"\n                ],\n                \"postalCode\": \"8005\"\n              }\n            ],\n            \"id\": \"org\",\n            \"identifier\": [\n              {\n                \"system\": \"urn:oid:2.51.1.3\",\n                \"value\": \"7601000234438\"\n              }\n            ],\n            \"name\": \"Hausarzt\",\n            \"resourceType\": \"Organization\"\n          },\n          {\n            \"id\": \"pract\",\n            \"identifier\": [\n              {\n                \"system\": \"urn:oid:2.51.1.3\",\n                \"value\": \"7601000234438\"\n              }\n            ],\n            \"name\": [\n              {\n                \"family\": \"Hausarzt\",\n                \"given\": [\n                  \"Familien\"\n                ]\n              }\n            ],\n            \"resourceType\": \"Practitioner\"\n          },\n          {\n            \"id\": \"practrole\",\n            \"organization\": {\n              \"reference\": \"#org\"\n            },\n            \"practitioner\": {\n              \"reference\": \"#pract\"\n            },\n            \"resourceType\": \"PractitionerRole\"\n          }\n        ],\n        \"content\": [\n          {\n            \"attachment\": {\n              \"contentType\": \"application/pdf\",\n              \"creation\": \"2011-11-29T11:00:00+01:00\",\n              \"language\": \"de-CH\",\n              \"url\": \"urn:uuid:59f3a738-11c1-4a0e-a89b-c4552d0fe9a7\",\n              \"title\": \"Document example title\"\n            },\n            \"format\": {\n              \"code\": \"urn:che:epr:EPR_Unstructured_Document\",\n              \"system\": \"urn:oid:2.16.756.5.30.1.127.3.10.10\"\n            }\n          }\n        ],\n        \"context\": {\n          \"facilityType\": {\n            \"coding\": [\n              {\n                \"code\": \"264358009\",\n                \"display\": \"General practice premises(environment)\",\n                \"system\": \"http://snomed.info/sct\"\n              }\n            ]\n          },\n          \"practiceSetting\": {\n            \"coding\": [\n              {\n                \"code\": \"394802001\",\n                \"display\": \"General medicine(qualifier value)\",\n                \"system\": \"http://snomed.info/sct\"\n              }\n            ]\n          },\n          \"sourcePatientInfo\": {\n            \"reference\": \"#1\"\n          }\n        },\n        \"date\": \"2011-11-29T11:00:00+01:00\",\n        \"description\": \"file.pdf\",\n        \"extension\": [\n          {\n            \"url\": \"http://fhir.ch/ig/ch-epr-fhir/StructureDefinition/ch-ext-author-authorrole\",\n            \"valueCoding\": {\n              \"code\": \"HCP\",\n              \"display\": \"Healthcare professional\",\n              \"system\": \"urn:oid:2.16.756.5.30.1.127.3.10.6\"\n            }\n          }\n        ],\n        \"identifier\": [\n          {\n            \"system\": \"urn:ietf:rfc:3986\",\n            \"use\": \"usual\",\n            \"value\": \"urn:oid:2.25.161286146254585515369612173924762763705\"\n          }\n        ],\n        \"masterIdentifier\": {\n          \"value\": \"urn:uuid:f3b905a6-f0e4-4ba6-9b6e-c7e7692c0438\"\n        },\n        \"resourceType\": \"DocumentReference\",\n        \"securityLabel\": [\n          {\n            \"coding\": [\n              {\n                \"code\": \"17621005\",\n                \"display\": \"Normally accessible\",\n                \"system\": \"http://snomed.info/sct\"\n              }\n            ]\n          }\n        ],\n        \"status\": \"current\",\n        \"subject\": {\n          \"reference\": \"Patient/2.16.756.5.30.1.191.1.0.2.1-c55f4ca7-bd4e-4134-8dcd-56b793ade958\"\n        },\n        \"type\": {\n          \"coding\": [\n            {\n              \"code\": \"772786005\",\n              \"display\": \"Medical certificate (record artifact)\",\n              \"system\": \"http://snomed.info/sct\"\n            }\n          ]\n        }\n      }\n    }\n  ],\n  \"meta\": {\n    \"profile\": [\n      \"http://profiles.ihe.net/ITI/MHD/StructureDefinition/IHE.MHD.Comprehensive.ProvideBundle\"\n    ]\n  },\n  \"resourceType\": \"Bundle\",\n  \"type\": \"transaction\"\n}\n</code></pre>"},{"location":"integration-primary-system/#444-updating-metadata-chmhd-1","title":"4.4.4 Updating Metadata [CH:MHD-1]","text":"<p>You can update document metadata with the CH:MHD-1 (Update Document Metadata) transaction.</p> <p>The transaction is an HTTP PUT request to the endpoint <code>/DocumentReference/{id}</code>, where <code>{id}</code> is the id value.</p> Example Update metadata<pre><code>PUT /DocumentReference/1c8d1f74-1686-4188-9c35-0c5727c771cc HTTP/1.1\nContent: application/fhir+json\n\n{\n  \"resourceType\": \"DocumentReference\",\n  \"id\": \"1c8d1f74-1686-4188-9c35-0c5727c771cc\",\n  \"contained\": [\n    {\n      \"resourceType\": \"Patient\",\n      \"id\": \"pat\",\n      \"identifier\": [\n        {\n          \"use\": \"usual\",\n          \"type\": {\n            \"coding\": [\n              {\n                \"system\": \"http://terminology.hl7.org/CodeSystem/v2-0203\",\n                \"code\": \"MR\"\n              }\n            ]\n          },\n          \"system\": \"urn:oid:2.999.1.2.3.4\",\n          \"value\": \"8734\"\n        }\n      ]\n    }\n  ],\n  \"extension\": [\n    {\n      \"url\": \"http://fhir.ch/ig/ch-epr-fhir/StructureDefinition/ch-ext-deletionstatus\",\n      \"valueCoding\": {\n        \"system\": \"urn:oid:2.16.756.5.30.1.127.3.10.18\",\n        \"code\": \"urn:e-health-suisse:2019:deletionStatus:deletionNotRequested\"\n      }\n    },\n    {\n      \"url\": \"http://fhir.ch/ig/ch-epr-fhir/StructureDefinition/ch-ext-author-authorrole\",\n      \"valueCoding\": {\n        \"system\": \"urn:oid:2.16.756.5.30.1.127.3.10.6\",\n        \"code\": \"HCP\",\n        \"display\": \"Healthcare professional\"\n      }\n    }\n  ],\n  \"masterIdentifier\": {\n    \"system\": \"urn:ietf:rfc:3986\",\n    \"value\": \"urn:oid:1.3.6.1.4.1.12559.11.13.2.1.2951\"\n  },\n  \"identifier\": [\n    {\n      \"system\": \"urn:ietf:rfc:3986\",\n      \"value\": \"urn:uuid:50383ae5-49e5-4dea-b0e6-660cb9e7b91f\"\n    }\n  ],\n  \"status\": \"current\",\n  \"type\": {\n    \"coding\": [\n      {\n        \"system\": \"http://snomed.info/sct\",\n        \"code\": \"721912009\",\n        \"display\": \"Medication summary document (record artifact)\"\n      }\n    ]\n  },\n  \"category\": [\n    {\n      \"coding\": [\n        {\n          \"system\": \"http://snomed.info/sct\",\n          \"code\": \"422735006\",\n          \"display\": \"Summary clinical document (record artifact)\"\n        }\n      ]\n    }\n  ],\n  \"subject\": {\n    \"identifier\": {\n      \"system\": \"urn:oid:2.16.756.5.30.1.127.3.10.3\",\n      \"value\": \"761337610411353650\"\n    }\n  },\n  \"description\": \"Changed Description for -MedicationCard\",\n  \"securityLabel\": [\n    {\n      \"coding\": [\n        {\n          \"system\": \"http://snomed.info/sct\",\n          \"code\": \"17621005\",\n          \"display\": \"Normal (qualifier value)\"\n        }\n      ]\n    }\n  ],\n  \"content\": [\n    {\n      \"attachment\": {\n        \"contentType\": \"text/xml\",\n        \"language\": \"de-CH\",\n        \"url\": \"http://example.com/xdsretrieve?uniqueId=urn:uuid:413eb0f7-aa72-4405-86a4-7793a23fcc27&amp;repositoryUniqueId=2.999.756.42.1\",\n        \"creation\": \"2020-06-29T11:58:00+00:00\"\n      },\n      \"format\": {\n        \"system\": \"http://ihe.net/fhir/ihe.formatcode.fhir/CodeSystem/formatcode\",\n        \"code\": \"urn:ihe:pharm:pml:2013\",\n        \"display\": \"Pharmacy PML\"\n      }\n    }\n  ],\n  \"context\": {\n    \"facilityType\": {\n      \"coding\": [\n        {\n          \"system\": \"http://snomed.info/sct\",\n          \"code\": \"264358009\",\n          \"display\": \"General practice premises (environment)\"\n        }\n      ]\n    },\n    \"practiceSetting\": {\n      \"coding\": [\n        {\n          \"system\": \"http://snomed.info/sct\",\n          \"code\": \"394802001\",\n          \"display\": \"General medicine (qualifier value)\"\n        }\n      ]\n    },\n    \"sourcePatientInfo\": {\n      \"reference\": \"#pat\"\n    }\n  }\n}\n</code></pre>"},{"location":"integration-primary-system/#45-professional-and-organization-directory","title":"4.5 Professional and Organization Directory","text":"<p>The HPD (Healthcare Provider Directory) contains information about the healthcare professionals and organizations that are part of the EPR. Relationships between them (i.e. membership of professionals to organizations, or relationships between organizations) are also available.</p>"},{"location":"integration-primary-system/#451-searching-iti-90","title":"4.5.1 Searching [ITI-90]","text":"<p>Professionals, organizations and relationships can be queried with an ITI-90 (Find Matching Care Services) transaction. See the specifications for the complete list of search parameters.</p> ProfessionalsOrganizationsRelationships <p>For professionals, the endpoint is <code>/Practitioner</code>.</p> Search for 'M\u00fcller'<pre><code>GET /Practitioner?family=M\u00fcller HTTP/1.1\n</code></pre> Search by GLN<pre><code>GET /Practitioner?identifier=urn:oid:2.51.1.3|7601000102737 HTTP/1.1\n</code></pre> Retrieve from identifier<pre><code>GET /Practitioner/DrPeterPan HTTP/1.1\n</code></pre> <p>For organizations, the endpoint is <code>/Organization</code>.</p> Search for active Organization whose name contains 'Medical'<pre><code>GET /Organization?active=true&amp;name:contains=Medical HTTP/1.1\n</code></pre> Retrieve from identifier<pre><code>GET /Organization/SpitalXDept3 HTTP/1.1\n</code></pre> <p>For relationships (memberships), the endpoint is <code>/PractitionerRole</code>.</p> Search for all professionals working at the 'HUG' organization<pre><code>GET /PractitionerRole?organization=Organization/HUG&amp;_include=PractitionerRole:practitioner HTTP/1.1\n</code></pre> Retrieve from identifier<pre><code>GET /PractitionerRole/PeterPanPraxisP HTTP/1.1\n</code></pre>"},{"location":"integration-primary-system/#452-updating-iti-59","title":"4.5.2 Updating [ITI-59]","text":"<p>The HPD update is not supported in a REST transaction. Please use the ITI-59 (Provider Information Feed) transaction.</p>"},{"location":"integration-primary-system/#46-audit-messages","title":"4.6 Audit Messages","text":""},{"location":"integration-primary-system/#461-creating-iti-20restful","title":"4.6.1 Creating [ITI-20]/RESTful","text":"<p>For all transactions, it is required to send the same audit messages. You can use the regular ITI-20 (Record Audit Event) transaction, or use the RESTful one.</p> <p>See the mapping from DICOM to FHIR.</p> Example <pre><code>POST /ARR/fhir/AuditEvent HTTP/1.1\nContent-Type: application/fhir+xml\n\n&lt;Bundle&gt;\n  &lt;entry&gt;\n    ...\n    &lt;request&gt;\n      &lt;method value=\"POST\"/&gt;\n    &lt;/request&gt;\n  &lt;/entry&gt;\n&lt;/Bundle&gt;\n</code></pre>"},{"location":"integration-primary-system/#462-reading-iti-81","title":"4.6.2 Reading [ITI-81]","text":"<p>You can read the audit messages for a given patient with an ITI-81 (Retrieve ATNA Audit Event) transaction.</p> <p>Warning</p> <p>The endpoint for this transaction is the EPR community itself, not the Mobile Access Gateway. This transaction is still implemented on a previous CH:ATC specification (March 2020), based on the IHE RESTful ATNA Supplement Rev. 2.2. A lot has changed since.</p> <p>The transaction is an HTTP GET request on the endpoint, with the parameter <code>entity-id</code> that contains the patient EPR-SPID, and <code>date</code> to constraint the audit message date. The <code>Authorization</code> header uses the prefix <code>IHE-SAML\u00a0</code> and the SAML assertion is encoded with the regular base64 alphabet.</p> <p>The community will ask other communities for their audit messages and regroup them all. If a foreign community is not reachable, an OperationOutcome may be added to the response Bundle.</p> Example <pre><code>GET /ARR/fhir/AuditEvent?entity-id=urn:oid:2.16.756.5.30.1.127.3.10.3|{epr-spid}&amp;date=ge2023-07-10&amp;date=le2023-07-17 HTTP/1.1\nAuthorization: IHE-SAML Zm9vYmE=\n</code></pre>"},{"location":"testing/","title":"5. Testing","text":""},{"location":"testing/#51-postman-collection","title":"5.1 Postman Collection","text":"<p>The provided Postman collection contains ready-to-use requests for the most common transactions supported by the Mobile Access Gateway (PIXm, PDQm $match and TCU publication).</p>"},{"location":"testing/#52-net-client-example","title":"5.2 .NET client example","text":"<p>An example how to call the PDQm $match operation and how to a technical user publication is available here.</p>"}]}